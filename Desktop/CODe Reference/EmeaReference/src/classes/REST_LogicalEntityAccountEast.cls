@RestResource(urlMapping='/getLogicalEntity/AccountEast_2/*')
global with sharing class REST_LogicalEntityAccountEast{ 
 
    public static final ID FarmRecordType = '012D00000002zq3IAA';
  public static final ID OtherRecordType = '012D000000038IgIAI';
    public static final Integer queryLimit = 250;
    @HttpPost  
    global static REST_LogicalEntity_Account getAccounts(REST_Request paramInfo)
    {
        REST_Request accRequest = paramInfo;
        REST_LogicalEntity_Account returned = new REST_LogicalEntity_Account(); 
        returned.Accounts = new List<Account>();
        returned.lastId='';
                
        Set<ID> accountsWithContactsModified = new Set<ID>();
    /*    
        for(Contact c : [SELECT AccountID from Contact WHERE lastModifiedDate > :accRequest.pagetimestamp ORDER BY lastModifiedDate LIMIT 25000]){
            accountsWithContactsModified.add(c.AccountID);
        }       
      */  
      for(Contact c : [SELECT AccountID 
                from Contact 
                WHERE lastModifiedDate > :accRequest.pagetimestamp 
                and
             id in (SELECT Contactid
            FROM ContactShare 
            WHERE UserOrGroupId=:Util.currentUser.Id AND (contactAccessLevel='Edit' OR contactAccessLevel='All'))
                ORDER BY lastModifiedDate LIMIT 25000]){
            accountsWithContactsModified.add(c.AccountID);
        } 
        
        List<ID> accShared = New List<ID>();
        
        for(AccountShare acc : [ SELECT AccountId
                                 FROM AccountShare 
                                 WHERE UserOrGroupId=:Util.currentUser.Id AND AccountAccessLevel='Edit'
                                        AND (NOT( Account.LastModifiedDate <= :accRequest.pagetimestamp
                                        AND AccountId NOT in:accountsWithContactsModified)) ])
        {
          accShared.add(acc.AccountId);
        }

        
        Integer rows=0;
 
        if(accRequest.mode==0)
        {
            for(Account acc: [  SELECT 
                        Account_Count__c,
                        AcreagesSegmentation__c,
                        Acreages_Min_Laboreo__c,
                        Acreage_Segmentation_PY__c,
                        Address_Door__c,
                        Address_line_1__c,
                        Address_line_2__c,
                        Address_line_3__c,
                        Address_Number__c,
                        AgreedMTOCornAcreagesCY__c,
                        AgreedMTOCornSalesCY__c,
                        Agreed_MTO_Corn_Sales_CY_Visited__c ,
                        //AgreeedCustomerShareCornCY__c,
                        AgronomistOfDistributor1Ref__c,
                        AgronomistOfDistributor2Ref__c,
                        AgronomistOfInfluencerRef__c,
                        Attivita_principale__c,
                        GC_Bank_Account_Number__c,
                        Bank_Branch_RSA__c,
                        BlankVATNumber_RSA__c,
                        Buyer_RSA__c,
                        Category__c,
                        Cattle__c,
                        GC_Mobile_Phone__c,
                        City_lckp__c,
                        City__c,
                        Client_Code__c,
                        Colaborador_ES__c,
                        Collaboratore_IT__c,
                        CompetitorTotalAcreagesCY__c,
                        CompetitorTotalAcreagesPY__c,
                        Contoterzista__c,
                        CornDekalbMarketshareCYPercentage__c,
                        CornDekalbMarketshareCY__c,
                        CornDekalbMarketsharePYPercentage__c,
                        CornDekalbMarketsharePY__c,
                        CornMSCompetitorCY__c,
                        CornMSCompetitorPY__c,
                        CornMSMonsantoCY__c,
                        CornMSMonsantoPY__c,
                        CornTotalAcreagesCY__c,
                        CornTotalAcreagesPY__c,
                        CornTotalSalesCY__c,
                        CornTotalSalesPY__c,
                        Corn_Total_Acreages_CY_Visited__c,
                        Corn_Total_Acreages_CY_with_Sales__c,
                        Corn_Total_Acreages_PY_Visited__c,
                        CountryID__c,
                        CountryRef__c,
                        County__c,
                        CPTotalSalesCY__c,
                        CPTotalSalesPY__c,
                        CreatedById,
                        CreatedDate,
                        Dairy_head_number__c,
                        PICK_who_plants__c,
                        PICK_Seeder_brand__c,
                        Data_privacy_agreement__c,
                        //DEKALB_Club_Member__c,
                        Description,
                        DE_Absatzpotenzial__c,
                        //DE_ACT_Vorlieferant__c,
                        DE_Ansprechpartner_ZV_CP__c,
                        DE_Ansprechpartner__c,
                        DE_Beiz__c,
                        DE_Biogasanlage__c,
                        DE_Checked_Date__c,
                        DE_Checked__c,
                        DE_Comments__c,
                        DE_Corn_Dekalb_Marketshare_PY_in__c,
                        DE_CornDekalbMarketshareCYPercentage__c,
                        DE_CornDekalbMarketsharePY__c,
                        DE_CP_AGREED_LAT_CY__c,
                        DE_CP_AGREED_LAT_PY__c,
                        DE_CP_AGREED_MON_CY__c,
                        DE_CP_AGREED_MON_PY__c,                 
                        DE_CP_AGREED_MONF_CY__c,
                        DE_CP_AGREED_MONF_PY__c,
                        DE_CP_AGREED_RUP_CY__c,
                        DE_CP_AGREED_RUP_PY__c,
                        DE_CP_POG_LAT_CY__c,
                        DE_CP_POG_LAT_PY__c,
                        DE_CP_POG_MON_CY__c,
                        DE_CP_POG_MON_PY__c,                    
                        DE_CP_POG_MONF_CY__c,
                        DE_CP_POG_MONF_PY__c,
                        DE_CP_POG_RUP_CY__c,
                        DE_CP_POG_RUP_PY__c,
                        DE_CustomerCornSeeds__c,
                        DE_CustomerOSRSeeds__c,
                        DE_Data_Source__c,
                        DE_ForecastCornCY__c,
                        DE_ForecastCornPY__c,
                        DE_ForecastCornFOCCY__c,
                        DE_ForecastCornFOCPY__c,
                        DE_ForecastOSRCY__c,
                        DE_ForecastOSRFOCCY__c, 
                        DE_ForecastOSRFOCPY__c,
                        DE_ForecastOSRPY__c,
                        DE_Forecast_LAT_CY__c,
                       ///DE_Forecast_LAT_FOC_CY__c,
                        //DE_Forecast_LAT_FOC_PY__c,
                        DE_Forecast_LAT_PY__c,
                        DE_Forecast_MON_CY__c,
                        DE_Forecast_MONF_CY__c,
                        //DE_Forecast_MON_FOC_CY__c,
                        //DE_Forecast_MON_FOC_PY__c,
                        DE_Forecast_MON_PY__c,
                        DE_Forecast_MONF_PY__c,
                        DE_Forecast_GLY_CY__c,
                        //DE_Forecast_RUP_FOC_CY__c,
                        //DE_Forecast_RUP_FOC_PY__c,
                        DE_Geno__c,
                        DE_ID_STATUS__c, 
                        DE_INDIRECT_CORN_COMP_CY__c,
                        DE_INDIRECT_CORN_COMP_PY__c,
                        DE_INDIRECT_CORN_MTO_CY__c,
                        DE_INDIRECT_CORN_MTO_PY__c,
                        DE_INDIRECT_LATITUDE_COMP_CY__c,
                        DE_INDIRECT_LATITUDE_COMP_PY__c,
                        DE_INDIRECT_LATITUDE_MTO_CY__c,
                        DE_INDIRECT_LATITUDE_MTO_PY__c,                 
                        DE_INDIRECT_MONFAST_COMP_CY__c,
                        DE_INDIRECT_MONFAST_COMP_PY__c,
                        DE_INDIRECT_MONFAST_MTO_CY__c,
                        DE_INDIRECT_MONFAST_MTO_PY__c,                  
                        DE_INDIRECT_MONITOR_COMP_CY__c,
                        DE_INDIRECT_MONITOR_COMP_PY__c,
                        DE_INDIRECT_MONITOR_MTO_CY__c,
                        DE_INDIRECT_MONITOR_MTO_PY__c,                  
                        DE_INDIRECT_OSR_COMP_CY__c,
                        DE_INDIRECT_OSR_COMP_PY__c,
                        DE_INDIRECT_OSR_MTO_CY__c,
                        DE_INDIRECT_OSR_MTO_PY__c,
                        DE_INDIRECT_ROUNDUP_COMP_CY__c,
                        DE_INDIRECT_ROUNDUP_COMP_PY__c,
                        DE_INDIRECT_ROUNDUP_MTO_CY__c,
                        DE_INDIRECT_ROUNDUP_MTO_PY__c,
                        DE_IsCPCustomer__c,
                        DE_IsOSRCustomer__c,
                        DE_IsSTCustomer__c,
                        DE_Landkreis__c,
                        DE_Latitude_ZV_CY__c,
                        DE_Latitude_ZV_PY__c,
                        DE_MA_ACTIVE_MARKET_ANALISIS__c,
                        DE_MA_MTO_POSITIONING_DIST__c,
                        DE_MA_QUALITY_SECURITY_ORIENT_FARM__c,
                        DE_MA_Raps_Plan_CY__c,
                        DE_MA_SHOPPING_BEHAVIOUR_DIST__c,
                        DE_MA_SHOPPING_BEHAVIOUR_FARM__c,
                        DE_MA_SOIL_TREATMENT_FARM__c,
                        DE_MA_VALUE_ORIENTED_DIST__c,
                        DE_Mais_MA_PY__c,
                        DE_Monfast_ZV_CY__c,
                        DE_Monfast_ZV_PY__c,
                        DE_Monitor_ZV_CY__c,
                        DE_Monitor_ZV_PY__c,                
                        DE_MS_Lattitude_CY__c,
                        DE_MS_Lattitude_PY__c,
                        DE_MS_Monfast_CY__c,
                        DE_MS_Monfast_PY__c,
                        DE_MS_Monitor_CY__c,
                        DE_MS_Monitor_PY__c,
                        DE_MS_RUP_CY__c,
                        DE_MS_RUP_PY__c,
                        DE_OSR_Dekalb_Marketshare_CY__c,
                        DE_OSR_Dekalb_Marketshare_PY__c,
                        DE_OSRDekalbMarketCY_c__c,
                        DE_OSRDekalbMarketsharePY__c,
                        DE_OwnersFlat__c,
                        DE_Owners__c,
                        DE_PLZ__c,
                        DE_PoG_LAT_FOC_CY__c,
                        DE_PoG_LAT_FOC_PY__c,
                        DE_PoG_MON_FOC_CY__c,
                        DE_PoG_MON_FOC_PY__c,
                        DE_PoG_RUP_FOC_CY__c,
                        DE_PoG_RUP_FOC_PY__c,
                        DE_POGCornCY__c,
                        DE_POGCornFOCCY__c,
                        DE_POGCornFOCPY__c,
                        DE_POGCornPY__c,
                        DE_POGOSRCY__c,
                        DE_POGOSRFOCCY__c,
                        DE_POGOSRFOCPY__c,
                        DE_POGOSRPY__c,
                        DE_Potenzialausschoepfung__c,
                        DE_Potenzial_Mais_CY__c,
                        DE_Potenzial_Mais_PY__c,
                        DE_Potenzial_Raps_CY__c,
                        DE_Potenzial_Raps_PY__c,
                        DE_PS__c,
                        DE_PRIORITY_CORN__c,
                        DE_PRIORITY_OSR__c,
                        DE_Responsable_TD_S_T__c,
                        DE_Responsable_TD_CP__c,
                        DE_RetoureOSR1__c,
                        DE_RetoureOSR2__c,
                        DE_RetoureOSR3__c,
                        DE_Roundoup_ZV_CY__c,
                        DE_Roundup_ZV_PY__c,
                        DE_SALES_TREND_CY_PY_UNITS__c,
                        DE_SALES_TREND_CY_PY__c,
                        DE_Territory_Key__c,
                        DE_Total_Other_Acreages_CY__c,
                        DE_Total_Other_Acreages_PY__c,
                        DE_TotalArableAcreagesCY__c,
                        DE_TotalArableAcreagesPY__c,
                        DE_TotalCerealAcreagesCY__c,
                        DE_TotalCerealAcreagesPY__c,
                        DE_Winterraps_MA_PY__c,
                        DE_ZIP_PLZ__c,
                        Dir_Harvest_Acreages__c,
                        Disease__c,
                        Distributor1Ref__c,
                        Distributor2Ref__c,
                        Dryer__c,
                        Early_buyer__c,
                        GC_Email_Address__c,
                        ES_Level__c,
                        Farm_Storage__c,
                        Favourite__c,
                        Fax,
                        FCPArelevant__c,
                        FieldTexture__c,
                        ForecastCustomerShareCornCY__c,
                        ForecastMTOCornAcreagesCY__c,
                        ForecastMTOCornSalesCY__c,
                        Frazione__c,
                        //frmla_HU_AccountName_Code__c,
                        FR_Corn_Total_Acreages_CY_or_PY__c,
                        FR_PRIMARY_CONTACT__c,
                        Harvest_date__c,
                        //HasUnsoldHybrids__c,
                        HU_1TON_NEWPARTNER_CHECK__c,
                        HU_Acc_Plan_Farmer_OSR__c,
                        HU_Acc_Plan_Farmer__c,
                        HU_KPI4__c,
                        Id,
                        idDevice__c,
                        IDNumber_RSA__c,
                        ImportId__c,
                        Import_Source__c,
                        Influencer__c,
                        Irrigant__c,
                        IsCreateCampaignLineItem__c,
                        //IsDeleted,
                        //JigsawCompanyId,
                        LastActivityDate,
                        LastModifiedById,
                        LastModifiedDate,
                        //LastReferencedDate,
                        //LastViewedDate,
                        Last_Activity_Date__c,
                        GC_Longitude__c,
                        Level__c,
                        GC_Latitude__c,
                        //Managers_Name__c,
                        MasterRecordId,
                        MA_Mais_Plan_CY__c,
                        Micro_Region__c,
                        GC_Segmentation_Descr__c,
                        MS_Segmentation_PY__c,
                        Name,
                        Office_number__c,
                        OSRDekalbMarketshareCYPercentage__c,
                        OSRDekalbMarketshareCY__c,
                        OSRDekalbMarketsharePYPercentage__c,
                        OSRDekalbMarketsharePY__c,
                        OSRMSCompetitorCY__c,
                        OSRMSCompetitorPY__c,
                        OSRMSMonsantoCY__c,
                        OSRMSMonsantoPY__c,
                        OSRTotalAcreagesCY__c,
                        OSRTotalAcreagesPY__c,
                        OSRTotalSalesCY__c,
                        OSRTotalSalesPY__c,
                        OwnerId,
                        ParentId,
                        Phone,
                        Phone_2__c,
                        PoGCustomerShareCornCY__c,
                        PoGCustomerShareCornPY__c,
                        PoGMTOCornAcreagesCY__c,
                        PoGMTOCornAcreagesPY__c,
                        PrimaryCompetitor__c,
                        PrimaryDistributor__c,
                        PrimaryPoS__c,
                        PrimaryRetailer__c,
                        Primary_Distributor_Competitor__c,
                        Primary_Point_of_Sales_Competitor__c,
                        Province_lckp__c,
                        Purchase_channel__c,
                        Purchase_date__c,
                        Rating__c,
                        RecordTypeId,
                        Region_lckp__c,
                        RO_Client_Segmentation__c,
                        SAP_Number_RSA__c,
                        GC_SAP_ID__c,
                        SD_Machine__c,
                        Sowing_date__c,
                        StateProvince__c,
                        Street__c,
                        SubType_IT__c,
                        SystemModstamp,
                        Top10Customer__c,
                        TotalAcreagesCY__c,
                        TotalAcreagesPY__c,
                        TotalCornAcreagesManualCY__c,
                        TotalCornAcreagesManualPY__c,
                        TotalCornSalesCompetitorCY__c,
                        TotalCornSalesCompetitorPY__c,
                        TotalCornTPCompetitorCY__c,
                        TotalCornTPCompetitorPY__c,
                        TotalCornTPMonsantoCY__c,
                        TotalCornTPMonsantoPY__c,
                        TotalOSRAcreagesManualCY__c,
                        TotalOSRAcreagesManualPY__c,
                        TotalOSRSalesCompetitorCY__c,
                        TotalOSRSalesCompetitorPY__c,
                        TotalOSRTPCompetitorCY__c,
                        TotalOSRTPCompetitorPY__c,
                        TotalOSRTPMonsantoCY__c,
                        TotalOSRTPMonsantoPY__c,
                        TotalOtherAcreagesManualCY__c,
                        TotalOtherAcreagesManualPY__c,
                        Trials_Interested__c,
                        //Trust_CC_Mpy_Value_RSA__c,
                        Type_IT__c,
                        Type_of_cattle__c,
                        Type_of_irrigation__c,
                        Unit__c,
                        GC_VATIN_Number__c,
                        Virulence__c,
                        GC_is_Visited__c,
                        Visited_PY__c,
                        Website,
                        Website__c,
                        ZIPPostalCode__c,
                        ZIP_lckp__c,
                        //z_EMail__c,
                        FiscalCode__c,
                        RO_CUSTOMER_SEGMENTATION__c,
                        RO_CUSTOMER_SEGMENTATION_OSR__c,
                        shared__c,
                    /** Begin: Field Addition on Account - 20/06/2014**/ 
                        AccountNumber,
                        CoopName_RSA__c,
                        CoopMember_RSA__c,
                        //CreatedBy,
                        //DE_CP_POG_MON_PY__c,
                        //DE_CP_AGREED_MON_PY__c,
                        //DE_ForecastOSRFOCCY__c,
                        //DE_ID_STATUS__c,
                        //DE_INDIRECT_LATITUDE_MTO_PY__c,
                        //DE_INDIRECT_MONFAST_MTO_PY__c,
                        //DE_INDIRECT_MONITOR_MTO_PY__c,
                        //DE_Monitor_ZV_PY__c,
                        //DE_RetoureOSR1__c,
                        //DE_RetoureOSR2__c,
                        //DE_RetoureOSR3__c,
                        //LastModifiedBy,
                        //Owner,
                        //Parent,
                        //RecordType,
                        AccountSource,
                        AcreagesComparisonCheck__c,
                        //Agreed_MTO_Corn_Sales_CY_Visited__c,
                        Categoria__c,
                        CP_ACTIMUM_ZV_CY__c,
                        CP_ACTIMUM_ZV_PY__c,
                        CP_AGREED_ACT_CY__c,
                        CP_AGREED_ACT_PY__c,
                        CP_FORECAST_ACT_CY__c,
                        CP_FORECAST_ACT_PY__c,
                        CP_AGREED_GUA_CY__c,
                        CP_AGREED_GUA_PY__c,
                        CP_AGREED_HAR_CY__c,
                        CP_AGREED_HAR_PY__c,
                        CP_FORECAST_GUA_CY__c,
                        CP_FORECAST_GUA_PY__c,
                        CP_FORECAST_HAR_CY__c,
                        CP_FORECAST_HAR_PY__c,
                        CP_GUARDIAN_ZV_CY__c,
                        CP_GUARDIAN_ZV_PY__c,
                        CP_Harness_ZV_CY__c,
                        CP_MS_ACTIMUM_CY__c,
                        CP_Harness_ZV_PY__c,
                        CP_MS_ACTIMUM_PY__c,
                        CP_MS_GUARDIAN_CY__c,
                        CP_MS_GUARDIAN_PY__c,
                        CP_MS_HARNESS_CY__c,
                        CP_MS_HARNESS_PY__c,
                        CP_POG_ACT_CY__c,
                        CP_POG_ACT_PY__c,
                        CP_POG_GUA_CY__c,
                        CP_POG_GUA_PY__c,
                        CP_POG_HAR_CY__c,
                        CP_POG_HAR_PY__c,
                        Entrepreneur__c,
                        FR_Account_Target__c,
                        FR_Activity_Detail__c,
                        FR_Distributor_Level__c,
                        FR_Main_Activity__c,
                        FR_OGM_Analyse__c,
                        FR_POG_CORN_MS_CY__c,
                        FR_POG_CORN_MS_PY__c,
                        FR_POG_OSR_MS_CY__c,
                        FR_POG_OSR_MS_PY__c,
                        FR_Reason__c,
                        FR_Type_de_Ferme__c,
                        INSEE_FR__c,
                        Percentage__c,
                        Subcategory__c,
                        Subzone__c,
                        Type,
                        /** RSA fields for iPad **/                    
                        PICK_TERRITORY_SEGMENT__c,
                        Trust_CC_Mpy_RSA__c,
                        Trust_CC_Mpy_Value_RSA__c,
                        BankAccountHolder_RSA__c,
                        PostalAddress_Region_RSA__c,
                        GC_Bank_Name__c,
                        owner.name,
                        GC_Status_Descr__c,
                        Account_ID_RSA__c,
                        AttachmentLanguage__c,
                        iPadtab__c,     
						/** END RSA fields for iPad **/                                             
                    /** End : Field Addition on Account - 20/06/2014**/ 
                        (
                            SELECT 
                                    /** RSA fields for iPad **/
                                    Position__c,
                                    AssistantPhone,
                                    HomePhone,
                                    /** END RSA fields for iPad **/
                                    AccountId,
                                    Address_Door__c,
                                    Address_line_2__c,
                                    Address_line_3__c,
                                    Address_Number__c,
                                    Adress_line_1__c,
                                    AgreesEmail__c,
                                    AgreesMail__c,
                                    AgreesSMS__c,
                                    Agronomist__c,
                                    Birthdate,
                                    //City_lckp__c,
                                    City__c,
                                    ContactOrigin_ES__c,
                                    Contact_Code__c,
                                    CornDecision__c,
                                    Corn__c,
                                    CountryRef__c,
                                    County__c,
                                    CP__c,
                                    CreatedById,
                                    CreatedDate,
                                    Data_Privacy_Agreement__c,
                                    Decision_Maker__c,
                                    Description,
                                    DE_ACCOUNT_IDSTATUS__c,
                                    //DE_ACCOUNT_OWNERS__c,
                                    DE_ACCOUNT_POTENZIALAUS__c,
                                    DE_ACT_CREATED_BY__c,
                                    DE_ACT_CREATED_DATE__c,
                                    DE_ACT_Vorlieferant__c,
                                    DE_BundeslandPrivat__c,
                                    DE_Checked_Date__c,
                                    DE_Checked__c,
                                    DE_CHECK_BEIZ__c,
                                    DE_Comments__c,
                                    DE_CORN_PICK__c,
                                    DE_Ctproz__c,
                                    DE_Data_Source__c,
                                    DE_DEAR__c,
                                    DE_Division__c,
                                    DE_EmailNotSure__c,
                                    DE_EMAIL_NOTSURE__c,
                                    DE_ENERGY_PICK__c,
                                    DE_Firma__c,
                                    DE_FRML_ABSATZPOTENZ_CP__c,
                                    DE_FRML_LETTERHEAD__c,
                                    DE_Function__c,
                                    DE_Keine_SMS__c,
                                    DE_Kein_Brief__c,
                                    DE_Kein_E_Mail__c,
                                    DE_Kein_Fax__c,
                                    DE_Kein_Mail__c,
                                    DE_Kein_Telemarketing__c,
                                    DE_Landkreis__c,
                                    DE_MA_ACTIVE_MARKET_ANALISIS__c,
                                    DE_MA_ATTENDANCE_EVENTS__c,
                                    DE_MA_MTO_POSITIONING_DIST__c,
                                    DE_MA_PERSONAL_CONTACT__c,
                                    DE_MA_PRO_CONTRA_MONSANTO__c,
                                    DE_MA_QUALITY_SECURITY_ORIENT_FARM__c,
                                    DE_MA_SHOPPING_BEHAVIOUR_DIST__c,
                                    DE_MA_SHOPPING_BEHAVIOUR_FARM__c,
                                    DE_MA_SOIL_TREATMENT_FARM__c,
                                    DE_MA_VALUE_ORIENTED_DIST__c,
                                    DE_MonsantoAffinity__c,
                                    DE_MonsantoID__c,
                                    DE_OSR_PICK__c,
                                    DE_PICK_PS__c,
                                    DE_PICK_ST__c,
                                    DE_Position__c,
                                    DE_PreferredContact__c,
                                    DE_PrivateCity__c,
                                    DE_PrivatePhone__c,
                                    DE_PrivateStreet__c,
                                    DE_PrivateZIP__c,
                                    DE_PrivateCountry__c,
                                    DE_Private_Landkreis__c,
                                    DE_Private_State_Province__c,
                                    DE_Sehr_geehrte__c,
                                    DE_Territory_Key__c,
                                    DE_Private_Territory_Key__c,
                                    DE_TEMP_AGCHEM__c,
                                    DE_TEMP_BIOTECH__c,
                                    DE_TEMP_PLANNED__c,
                                    DE_TEMP_SEEDS__c,
                                    DE_TEMP_TRIALFARM__c,
                                    DE_TEMP_VIPMAIS__c,
                                    DE_Website__c,
                                    DE_ZIP_PLZ__c,
                                    Email,
                                    EmailBouncedDate,
                                    EmailBouncedReason,
                                    Entrepreneur__c,
                                    ES_Position__c,
                                    GC_Facebook_URL__c,
                                    Fax,
                                    FCPArelevant__c,
                                    //Firma__c,
                                    FirstName,
                                    fmla_Account_RecordType_ID__c,
                                    FRML_ACCOUNT_CITY__c,
                                    FRML_ACCOUNT_POSTAL_CODE__c,
                                    FRML_ACCOUNT_LANDKREIS__c,
                                    FRML_ACCOUNT_STATE__c,
                                    FRML_ACCOUNT_STREET__c,
                                    FR_Contact_Position_1__c,
                                    FR_Contact_Position_2__c,
                                    FR_Total_Corn_Potential_CY__c,
                                    FR_Total_Corn_Potential_PY__c,
                                    FR_Total_DEKALB_OSR_Potential_CY__c,
                                    FR_Total_OSR_Potencial_CY__c,
                                    Gender__c,
                                    Id, 
                                    idDevice__c,
                                    ImportId__c,
                                    Import_Source__c,
                                    Influencer__c,
                                    IsDeleted,
                                    JigsawContactId,
                                    GC_Is_Key_Contact__c,
                                    LastActivityDate,
                                    LastCURequestDate,
                                    LastCUUpdateDate,
                                    LastModifiedById,
                                    LastModifiedDate,
                                    LastName,
                                    //LastReferencedDate,
                                    //LastViewedDate,
                                    LeadSource,
                                    //GC_Highest_Educ_Lvl_Descr__c,
                                    Loyalty__c,
                                    MarithalStatus__c,
                                    Marketing_Agreement__c,
                                    MasterRecordId,
                                    Micro_Region__c,
                                    MobilePhone,
                                    Name,
                                    Officenumber_RSA__c,
                                    Office__c,
                                    OSRDecision__c,
                                    OSR__c,
                                    OtherPhone,
                                    OwnerId,
                                    Percentage__c,
                                    Phone,
                                    Position_picklist__c,
                                    PostalAddressRegion_RSA__c,
                                    GC_Pref_Contact_Method_Descr__c,
                                    //Province_lckp__c,
                                    //Region_lckp__c,
                                    Salutation,
                                    StateProvince__c,
                                    Status__c,
                                    Street__c,
                                    Subtype__c,
                                    SystemModstamp,
                                    Title,
                                    Total_OSR_Potential_PY__c,
                                    GC_Twitter_URL__c,
                                    GC_Type_Descr__c,
                                    Type__c,
                                    ZIPPostalCode__c,
                                    //ZIP_lckp__c,
                                    //z_EMail__c,
                                    /***************/
                                    DAT_ReviewDate__c,
                                    DecisionMakerCornOSR__c,
                                    DEKALB_Club_Member__c,
                                    FR_Farmer_Qualification__c,
                                    //OtherAddress,
                                    FR_Total_DEKALB_Corn_Potential_CY__c,
                                    FR_Total_DEKALB_Corn_Potential_PY__c,
                                    FR_Total_DEKALB_OSR_Potential_PY__c,
                                    FRML_ACCOUNT_COUNTY__c,
                                    VISITED_CHK__c                                    
                            from Contacts ) 
                        FROM Account
                        WHERE (NOT( lastModifiedDate <= :accRequest.pagetimestamp AND Id NOT in :accountsWithContactsModified ))
                               AND( RecordTypeId!=:OtherRecordType AND RecordTypeId!=null)
                                AND (NOT( OwnerId!=:Util.currentUser.id  
                                AND ID  in : accShared ))
                        AND ID> : accRequest.lastId
                        // AND ID IN ('001M000000YsUsK','001D000000vJ0wY')
                         ORDER BY ID 
                         LIMIT : queryLimit      
                        ])
            {
                returned.Accounts.add(acc);
            }
            
            rows=returned.Accounts.size();
            if(rows<queryLIMIT)
            {
                accRequest.mode=1; 
                accRequest.lastId='';
                returned.mode=1;             
            }
            else
            {
                accRequest.mode=0;
                accRequest.lastId=returned.Accounts.get(rows-1).Id;
            }
        
             
        }
        
        if(accRequest.mode==1)
        {                  
            for(Account acc: [  SELECT 
                        Account_Count__c,
                        AcreagesSegmentation__c,
                        Acreages_Min_Laboreo__c,
                        Acreage_Segmentation_PY__c,
                        Address_Door__c,
                        Address_line_1__c,
                        Address_line_2__c,
                        Address_line_3__c,
                        Address_Number__c,
                        AgreedMTOCornAcreagesCY__c,
                        AgreedMTOCornSalesCY__c,
                        Agreed_MTO_Corn_Sales_CY_Visited__c ,
                        //AgreeedCustomerShareCornCY__c,
                        AgronomistOfDistributor1Ref__c,
                        AgronomistOfDistributor2Ref__c,
                        AgronomistOfInfluencerRef__c,
                        Attivita_principale__c,
                        GC_Bank_Account_Number__c,
                        Bank_Branch_RSA__c,
                        BlankVATNumber_RSA__c,
                        Buyer_RSA__c,
                        Category__c,
                        Cattle__c,
                        GC_Mobile_Phone__c,
                        City_lckp__c,
                        City__c,
                        Client_Code__c,
                        Colaborador_ES__c,
                        Collaboratore_IT__c,
                        CompetitorTotalAcreagesCY__c,
                        CompetitorTotalAcreagesPY__c,
                        Contoterzista__c,
                        CornDekalbMarketshareCYPercentage__c,
                        CornDekalbMarketshareCY__c,
                        CornDekalbMarketsharePYPercentage__c,
                        CornDekalbMarketsharePY__c,
                        CornMSCompetitorCY__c,
                        CornMSCompetitorPY__c,
                        CornMSMonsantoCY__c,
                        CornMSMonsantoPY__c,
                        CornTotalAcreagesCY__c,
                        CornTotalAcreagesPY__c,
                        CornTotalSalesCY__c,
                        CornTotalSalesPY__c,
                        Corn_Total_Acreages_CY_Visited__c,
                        Corn_Total_Acreages_CY_with_Sales__c,
                        Corn_Total_Acreages_PY_Visited__c,
                        CountryID__c,
                        CountryRef__c,
                        County__c,
                        CPTotalSalesCY__c,
                        CPTotalSalesPY__c,
                        CreatedById,
                        CreatedDate,
                        //Dairy_head_number__c,
                        Data_privacy_agreement__c,
                        //DEKALB_Club_Member__c,
                        Description,
                        DE_Absatzpotenzial__c,
                        //DE_ACT_Vorlieferant__c,
                        DE_Ansprechpartner_ZV_CP__c,
                        DE_Ansprechpartner__c,
                        DE_Beiz__c,
                        DE_Biogasanlage__c,
                        DE_Checked_Date__c,
                        DE_Checked__c,
                        DE_Comments__c,
                        DE_Corn_Dekalb_Marketshare_PY_in__c,
                        DE_CornDekalbMarketshareCYPercentage__c,
                        DE_CornDekalbMarketsharePY__c,
                        DE_CP_AGREED_LAT_CY__c,
                        DE_CP_AGREED_LAT_PY__c,
                        DE_CP_AGREED_MON_CY__c,
                        DE_CP_AGREED_MON_PY__c,                 
                        DE_CP_AGREED_MONF_CY__c,
                        DE_CP_AGREED_MONF_PY__c,
                        DE_CP_AGREED_RUP_CY__c,
                        DE_CP_AGREED_RUP_PY__c,
                        DE_CP_POG_LAT_CY__c,
                        DE_CP_POG_LAT_PY__c,
                        DE_CP_POG_MON_CY__c,
                        DE_CP_POG_MON_PY__c,                    
                        DE_CP_POG_MONF_CY__c,
                        DE_CP_POG_MONF_PY__c,
                        DE_CP_POG_RUP_CY__c,
                        DE_CP_POG_RUP_PY__c,
                        DE_CustomerCornSeeds__c,
                        DE_CustomerOSRSeeds__c,
                        DE_Data_Source__c,
                        DE_ForecastCornCY__c,
                        DE_ForecastCornPY__c,
                        DE_ForecastCornFOCCY__c,
                        DE_ForecastCornFOCPY__c,
                        DE_ForecastOSRCY__c,
                        DE_ForecastOSRFOCCY__c, 
                        DE_ForecastOSRFOCPY__c,
                        DE_ForecastOSRPY__c,
                        DE_Forecast_LAT_CY__c,
                       ///DE_Forecast_LAT_FOC_CY__c,
                        //DE_Forecast_LAT_FOC_PY__c,
                        DE_Forecast_LAT_PY__c,
                        DE_Forecast_MON_CY__c,
                        DE_Forecast_MONF_CY__c,
                        //DE_Forecast_MON_FOC_CY__c,
                        //DE_Forecast_MON_FOC_PY__c,
                        DE_Forecast_MON_PY__c,
                        DE_Forecast_MONF_PY__c,
                        //DE_Forecast_RUP_FOC_CY__c,
                        //DE_Forecast_RUP_FOC_PY__c,
                        DE_Geno__c,
                        DE_ID_STATUS__c, 
                        DE_INDIRECT_CORN_COMP_CY__c,
                        DE_INDIRECT_CORN_COMP_PY__c,
                        DE_INDIRECT_CORN_MTO_CY__c,
                        DE_INDIRECT_CORN_MTO_PY__c,
                        DE_INDIRECT_LATITUDE_COMP_CY__c,
                        DE_INDIRECT_LATITUDE_COMP_PY__c,
                        DE_INDIRECT_LATITUDE_MTO_CY__c,
                        DE_INDIRECT_LATITUDE_MTO_PY__c,                 
                        DE_INDIRECT_MONFAST_COMP_CY__c,
                        DE_INDIRECT_MONFAST_COMP_PY__c,
                        DE_INDIRECT_MONFAST_MTO_CY__c,
                        DE_INDIRECT_MONFAST_MTO_PY__c,                  
                        DE_INDIRECT_MONITOR_COMP_CY__c,
                        DE_INDIRECT_MONITOR_COMP_PY__c,
                        DE_INDIRECT_MONITOR_MTO_CY__c,
                        DE_INDIRECT_MONITOR_MTO_PY__c,                  
                        DE_INDIRECT_OSR_COMP_CY__c,
                        DE_INDIRECT_OSR_COMP_PY__c,
                        DE_INDIRECT_OSR_MTO_CY__c,
                        DE_INDIRECT_OSR_MTO_PY__c,
                        DE_INDIRECT_ROUNDUP_COMP_CY__c,
                        DE_INDIRECT_ROUNDUP_COMP_PY__c,
                        DE_INDIRECT_ROUNDUP_MTO_CY__c,
                        DE_INDIRECT_ROUNDUP_MTO_PY__c,
                        DE_IsCPCustomer__c,
                        DE_IsOSRCustomer__c,
                        DE_IsSTCustomer__c,
                        DE_Landkreis__c,
                        DE_Latitude_ZV_CY__c,
                        DE_Latitude_ZV_PY__c,
                        DE_MA_ACTIVE_MARKET_ANALISIS__c,
                        DE_MA_MTO_POSITIONING_DIST__c,
                        DE_MA_QUALITY_SECURITY_ORIENT_FARM__c,
                        DE_MA_Raps_Plan_CY__c,
                        DE_MA_SHOPPING_BEHAVIOUR_DIST__c,
                        DE_MA_SHOPPING_BEHAVIOUR_FARM__c,
                        DE_MA_SOIL_TREATMENT_FARM__c,
                        DE_MA_VALUE_ORIENTED_DIST__c,
                        DE_Mais_MA_PY__c,
                        DE_Monfast_ZV_CY__c,
                        DE_Monfast_ZV_PY__c,
                        DE_Monitor_ZV_CY__c,
                        DE_Monitor_ZV_PY__c,                
                        DE_MS_Lattitude_CY__c,
                        DE_MS_Lattitude_PY__c,
                        DE_MS_Monfast_CY__c,
                        DE_MS_Monfast_PY__c,
                        DE_MS_Monitor_CY__c,
                        DE_MS_Monitor_PY__c,
                        DE_MS_RUP_CY__c,
                        DE_MS_RUP_PY__c,
                        DE_OSR_Dekalb_Marketshare_CY__c,
                        DE_OSR_Dekalb_Marketshare_PY__c,
                        DE_OSRDekalbMarketCY_c__c,
                        DE_OSRDekalbMarketsharePY__c,
                        DE_OwnersFlat__c,
                        DE_Owners__c,
                        DE_PLZ__c,
                        DE_PoG_LAT_FOC_CY__c,
                        DE_PoG_LAT_FOC_PY__c,
                        DE_PoG_MON_FOC_CY__c,
                        DE_PoG_MON_FOC_PY__c,
                        DE_PoG_RUP_FOC_CY__c,
                        DE_PoG_RUP_FOC_PY__c,
                        DE_POGCornCY__c,
                        DE_POGCornFOCCY__c,
                        DE_POGCornFOCPY__c,
                        DE_POGCornPY__c,
                        DE_POGOSRCY__c,
                        DE_POGOSRFOCCY__c,
                        DE_POGOSRFOCPY__c,
                        DE_POGOSRPY__c,
                        DE_Potenzialausschoepfung__c,
                        DE_Potenzial_Mais_CY__c,
                        DE_Potenzial_Mais_PY__c,
                        DE_Potenzial_Raps_CY__c,
                        DE_Potenzial_Raps_PY__c,
                        DE_PS__c,
                        DE_PRIORITY_CORN__c,
                        DE_PRIORITY_OSR__c,
                        DE_Responsable_TD_S_T__c,
                        DE_Responsable_TD_CP__c,
                        DE_RetoureOSR1__c,
                        DE_RetoureOSR2__c,
                        DE_RetoureOSR3__c,
                        DE_Roundoup_ZV_CY__c,
                        DE_Roundup_ZV_PY__c,
                        DE_SALES_TREND_CY_PY_UNITS__c,
                        DE_SALES_TREND_CY_PY__c,
                        DE_Territory_Key__c,
                        DE_Total_Other_Acreages_CY__c,
                        DE_Total_Other_Acreages_PY__c,
                        DE_TotalArableAcreagesCY__c,
                        DE_TotalArableAcreagesPY__c,
                        DE_TotalCerealAcreagesCY__c,
                        DE_TotalCerealAcreagesPY__c,
                        DE_Winterraps_MA_PY__c,
                        DE_ZIP_PLZ__c,
                        Dir_Harvest_Acreages__c,
                        Disease__c,
                        Distributor1Ref__c,
                        Distributor2Ref__c,
                        Dryer__c,
                        Early_buyer__c,
                        GC_Email_Address__c,
                        ES_Level__c,
                        Farm_Storage__c,
                        Favourite__c,
                        Fax,
                        FCPArelevant__c,
                        FieldTexture__c,
                        ForecastCustomerShareCornCY__c,
                        ForecastMTOCornAcreagesCY__c,
                        ForecastMTOCornSalesCY__c,
                        Frazione__c,
                        //frmla_HU_AccountName_Code__c,
                        FR_Corn_Total_Acreages_CY_or_PY__c,
                        FR_PRIMARY_CONTACT__c,
                        Harvest_date__c,
                        //HasUnsoldHybrids__c,
                        HU_1TON_NEWPARTNER_CHECK__c,
                        HU_Acc_Plan_Farmer_OSR__c,
                        HU_Acc_Plan_Farmer__c,
                        HU_KPI4__c,
                        Id,
                        idDevice__c,
                        IDNumber_RSA__c,
                        ImportId__c,
                        Import_Source__c,
                        Influencer__c,
                        Irrigant__c,
                        IsCreateCampaignLineItem__c,
                        //IsDeleted,
                        //JigsawCompanyId,
                        LastActivityDate,
                        LastModifiedById,
                        LastModifiedDate,
                        //LastReferencedDate,
                        //LastViewedDate,
                        Last_Activity_Date__c,
                        GC_Longitude__c,
                        Level__c,
                        GC_Latitude__c,
                        //Managers_Name__c,
                        MasterRecordId,
                        MA_Mais_Plan_CY__c,
                        Micro_Region__c,
                        GC_Segmentation_Descr__c,
                        MS_Segmentation_PY__c,
                        Name,
                        Office_number__c,
                        OSRDekalbMarketshareCYPercentage__c,
                        OSRDekalbMarketshareCY__c,
                        OSRDekalbMarketsharePYPercentage__c,
                        OSRDekalbMarketsharePY__c,
                        OSRMSCompetitorCY__c,
                        OSRMSCompetitorPY__c,
                        OSRMSMonsantoCY__c,
                        OSRMSMonsantoPY__c,
                        OSRTotalAcreagesCY__c,
                        OSRTotalAcreagesPY__c,
                        OSRTotalSalesCY__c,
                        OSRTotalSalesPY__c,
                        OwnerId,
                        ParentId,
                        Phone,
                        Phone_2__c,
                        PoGCustomerShareCornCY__c,
                        PoGCustomerShareCornPY__c,
                        PoGMTOCornAcreagesCY__c,
                        PoGMTOCornAcreagesPY__c,
                        PrimaryCompetitor__c,
                        PrimaryDistributor__c,
                        PrimaryPoS__c,
                        PrimaryRetailer__c,
                        Primary_Distributor_Competitor__c,
                        Primary_Point_of_Sales_Competitor__c,
                        Province_lckp__c,
                        Purchase_channel__c,
                        Purchase_date__c,
                        Rating__c,
                        RecordTypeId,
                        Region_lckp__c,
                        RO_Client_Segmentation__c,
                        SAP_Number_RSA__c,
                        GC_SAP_ID__c,
                        SD_Machine__c,
                        Sowing_date__c,
                        StateProvince__c,
                        Street__c,
                        SubType_IT__c,
                        SystemModstamp,
                        Top10Customer__c,
                        TotalAcreagesCY__c,
                        TotalAcreagesPY__c,
                        TotalCornAcreagesManualCY__c,
                        TotalCornAcreagesManualPY__c,
                        TotalCornSalesCompetitorCY__c,
                        TotalCornSalesCompetitorPY__c,
                        TotalCornTPCompetitorCY__c,
                        TotalCornTPCompetitorPY__c,
                        TotalCornTPMonsantoCY__c,
                        TotalCornTPMonsantoPY__c,
                        TotalOSRAcreagesManualCY__c,
                        TotalOSRAcreagesManualPY__c,
                        TotalOSRSalesCompetitorCY__c,
                        TotalOSRSalesCompetitorPY__c,
                        TotalOSRTPCompetitorCY__c,
                        TotalOSRTPCompetitorPY__c,
                        TotalOSRTPMonsantoCY__c,
                        TotalOSRTPMonsantoPY__c,
                        TotalOtherAcreagesManualCY__c,
                        TotalOtherAcreagesManualPY__c,
                        Trials_Interested__c,
                        //Trust_CC_Mpy_Value_RSA__c,
                        Type_IT__c,
                        Type_of_cattle__c,
                        Type_of_irrigation__c,
                        Unit__c,
                        GC_VATIN_Number__c,
                        Virulence__c,
                        GC_is_Visited__c,
                        Visited_PY__c,
                        Website,
                        Website__c,
                        ZIPPostalCode__c,
                        ZIP_lckp__c,
                        //z_EMail__c,
                        FiscalCode__c,
                        RO_CUSTOMER_SEGMENTATION__c,
                        RO_CUSTOMER_SEGMENTATION_OSR__c,
                        shared__c,
                    /** Begin: Field Addition on Account - 20/06/2014**/ 
                        AccountNumber,
                        CoopName_RSA__c,
                        CoopMember_RSA__c,
                        //CreatedBy,
                        //DE_CP_POG_MON_PY__c,
                        //DE_CP_AGREED_MON_PY__c,
                        //DE_ForecastOSRFOCCY__c,
                        //DE_ID_STATUS__c,
                        //DE_INDIRECT_LATITUDE_MTO_PY__c,
                        //DE_INDIRECT_MONFAST_MTO_PY__c,
                        //DE_INDIRECT_MONITOR_MTO_PY__c,
                        //DE_Monitor_ZV_PY__c,
                        //DE_RetoureOSR1__c,
                        //DE_RetoureOSR2__c,
                        //DE_RetoureOSR3__c,
                        //LastModifiedBy,
                        //Owner,
                        //Parent,
                        //RecordType,
                        AccountSource,
                        AcreagesComparisonCheck__c,
                        //Agreed_MTO_Corn_Sales_CY_Visited__c,
                        Categoria__c,
                        CP_ACTIMUM_ZV_CY__c,
                        CP_ACTIMUM_ZV_PY__c,
                        CP_AGREED_ACT_CY__c,
                        CP_AGREED_ACT_PY__c,
                        CP_FORECAST_ACT_CY__c,
                        CP_FORECAST_ACT_PY__c,
                        CP_AGREED_GUA_CY__c,
                        CP_AGREED_GUA_PY__c,
                        CP_AGREED_HAR_CY__c,
                        CP_AGREED_HAR_PY__c,
                        CP_FORECAST_GUA_CY__c,
                        CP_FORECAST_GUA_PY__c,
                        CP_FORECAST_HAR_CY__c,
                        CP_FORECAST_HAR_PY__c,
                        CP_GUARDIAN_ZV_CY__c,
                        CP_GUARDIAN_ZV_PY__c,
                        CP_Harness_ZV_CY__c,
                        CP_MS_ACTIMUM_CY__c,
                        CP_Harness_ZV_PY__c,
                        CP_MS_ACTIMUM_PY__c,
                        CP_MS_GUARDIAN_CY__c,
                        CP_MS_GUARDIAN_PY__c,
                        CP_MS_HARNESS_CY__c,
                        CP_MS_HARNESS_PY__c,
                        CP_POG_ACT_CY__c,
                        CP_POG_ACT_PY__c,
                        CP_POG_GUA_CY__c,
                        CP_POG_GUA_PY__c,
                        CP_POG_HAR_CY__c,
                        CP_POG_HAR_PY__c,
                        Entrepreneur__c,
                        FR_Account_Target__c,
                        FR_Activity_Detail__c,
                        FR_Distributor_Level__c,
                        FR_Main_Activity__c,
                        FR_OGM_Analyse__c,
                        FR_POG_CORN_MS_CY__c,
                        FR_POG_CORN_MS_PY__c,
                        FR_POG_OSR_MS_CY__c,
                        FR_POG_OSR_MS_PY__c,
                        FR_Reason__c,
                        FR_Type_de_Ferme__c,
                        INSEE_FR__c,
                        Percentage__c,
                        Subcategory__c,
                        Subzone__c,
                        Type,
                        /** RSA fields for iPad **/                    
                        PICK_TERRITORY_SEGMENT__c,
                        Trust_CC_Mpy_RSA__c,
                        Trust_CC_Mpy_Value_RSA__c,
                        BankAccountHolder_RSA__c,
                        PostalAddress_Region_RSA__c,
                        GC_Bank_Name__c,
                        owner.name,
                        GC_Status_Descr__c,
                        Account_ID_RSA__c,
                        AttachmentLanguage__c,
                        iPadtab__c,     
						/** END RSA fields for iPad **/    
                    /** End : Field Addition on Account - 20/06/2014**/ 
                        (
                            SELECT 
                                    /** RSA fields for iPad **/
                                    Position__c,
                                    AssistantPhone,
                                    HomePhone,
                                    /** END RSA fields for iPad **/
                                    AccountId,
                                    Address_Door__c,
                                    Address_line_2__c,
                                    Address_line_3__c,
                                    Address_Number__c,
                                    Adress_line_1__c,
                                    AgreesEmail__c,
                                    AgreesMail__c,
                                    AgreesSMS__c,
                                    Agronomist__c,
                                    Birthdate,
                                    //City_lckp__c,
                                    City__c,
                                    ContactOrigin_ES__c,
                                    Contact_Code__c,
                                    CornDecision__c,
                                    Corn__c,
                                    CountryRef__c,
                                    County__c,
                                    CP__c,
                                    CreatedById,
                                    CreatedDate,
                                    Data_Privacy_Agreement__c,
                                    Decision_Maker__c,
                                    Description,
                                    DE_ACCOUNT_IDSTATUS__c,
                                    //DE_ACCOUNT_OWNERS__c,
                                    DE_ACCOUNT_POTENZIALAUS__c,
                                    DE_ACT_CREATED_BY__c,
                                    DE_ACT_CREATED_DATE__c,
                                    DE_ACT_Vorlieferant__c,
                                    DE_BundeslandPrivat__c,
                                    DE_Checked_Date__c,
                                    DE_Checked__c,
                                    DE_CHECK_BEIZ__c,
                                    DE_Comments__c,
                                    DE_CORN_PICK__c,
                                    DE_Ctproz__c,
                                    DE_Data_Source__c,
                                    DE_DEAR__c,
                                    DE_Division__c,
                                    DE_EmailNotSure__c,
                                    DE_EMAIL_NOTSURE__c,
                                    DE_ENERGY_PICK__c,
                                    DE_Firma__c,
                                    DE_FRML_ABSATZPOTENZ_CP__c,
                                    DE_FRML_LETTERHEAD__c,
                                    DE_Function__c,
                                    DE_Keine_SMS__c,
                                    DE_Kein_Brief__c,
                                    DE_Kein_E_Mail__c,
                                    DE_Kein_Fax__c,
                                    DE_Kein_Mail__c,
                                    DE_Kein_Telemarketing__c,
                                    DE_Landkreis__c,
                                    DE_MA_ACTIVE_MARKET_ANALISIS__c,
                                    DE_MA_ATTENDANCE_EVENTS__c,
                                    DE_MA_MTO_POSITIONING_DIST__c,
                                    DE_MA_PERSONAL_CONTACT__c,
                                    DE_MA_PRO_CONTRA_MONSANTO__c,
                                    DE_MA_QUALITY_SECURITY_ORIENT_FARM__c,
                                    DE_MA_SHOPPING_BEHAVIOUR_DIST__c,
                                    DE_MA_SHOPPING_BEHAVIOUR_FARM__c,
                                    DE_MA_SOIL_TREATMENT_FARM__c,
                                    DE_MA_VALUE_ORIENTED_DIST__c,
                                    DE_MonsantoAffinity__c,
                                    DE_MonsantoID__c,
                                    DE_OSR_PICK__c,
                                    DE_PICK_PS__c,
                                    DE_PICK_ST__c,
                                    DE_Position__c,
                                    DE_PreferredContact__c,
                                    DE_PrivateCity__c,
                                    DE_PrivatePhone__c,
                                    DE_PrivateStreet__c,
                                    DE_PrivateZIP__c,
                                    DE_PrivateCountry__c,
                                    DE_Private_Landkreis__c,
                                    DE_Private_State_Province__c,
                                    DE_Sehr_geehrte__c,
                                    DE_Territory_Key__c,
                                    DE_Private_Territory_Key__c,
                                    DE_TEMP_AGCHEM__c,
                                    DE_TEMP_BIOTECH__c,
                                    DE_TEMP_PLANNED__c,
                                    DE_TEMP_SEEDS__c,
                                    DE_TEMP_TRIALFARM__c,
                                    DE_TEMP_VIPMAIS__c,
                                    DE_Website__c,
                                    DE_ZIP_PLZ__c,
                                    Email,
                                    EmailBouncedDate,
                                    EmailBouncedReason,
                                    Entrepreneur__c,
                                    ES_Position__c,
                                    GC_Facebook_URL__c,
                                    Fax,
                                    FCPArelevant__c,
                                    //Firma__c,
                                    FirstName,
                                    fmla_Account_RecordType_ID__c,
                                    FRML_ACCOUNT_CITY__c,
                                    FRML_ACCOUNT_POSTAL_CODE__c,
                                    FRML_ACCOUNT_LANDKREIS__c,
                                    FRML_ACCOUNT_STATE__c,
                                    FRML_ACCOUNT_STREET__c,
                                    FR_Contact_Position_1__c,
                                    FR_Contact_Position_2__c,
                                    FR_Total_Corn_Potential_CY__c,
                                    FR_Total_Corn_Potential_PY__c,
                                    FR_Total_DEKALB_OSR_Potential_CY__c,
                                    FR_Total_OSR_Potencial_CY__c,
                                    Gender__c,
                                    Id, 
                                    idDevice__c,
                                    ImportId__c,
                                    Import_Source__c,
                                    Influencer__c,
                                    IsDeleted,
                                    JigsawContactId,
                                    GC_Is_Key_Contact__c,
                                    LastActivityDate,
                                    LastCURequestDate,
                                    LastCUUpdateDate,
                                    LastModifiedById,
                                    LastModifiedDate,
                                    LastName,
                                    //LastReferencedDate,
                                    //LastViewedDate,
                                    LeadSource,
                                    //GC_Highest_Educ_Lvl_Descr__c,
                                    Loyalty__c,
                                    MarithalStatus__c,
                                    Marketing_Agreement__c,
                                    MasterRecordId,
                                    Micro_Region__c,
                                    MobilePhone,
                                    Name,
                                    Officenumber_RSA__c,
                                    Office__c,
                                    OSRDecision__c,
                                    OSR__c,
                                    OtherPhone,
                                    OwnerId,
                                    Percentage__c,
                                    Phone,
                                    Position_picklist__c,
                                    PostalAddressRegion_RSA__c,
                                    GC_Pref_Contact_Method_Descr__c,
                                    //Province_lckp__c,
                                    //Region_lckp__c,
                                    Salutation,
                                    StateProvince__c,
                                    Status__c,
                                    Street__c,
                                    Subtype__c,
                                    SystemModstamp,
                                    Title,
                                    Total_OSR_Potential_PY__c,
                                    GC_Twitter_URL__c,
                                    GC_Type_Descr__c,
                                    Type__c,
                                    ZIPPostalCode__c,
                                    //ZIP_lckp__c,
                                    //z_EMail__c,
                                    /***************/
                                    DAT_ReviewDate__c,
                                    DecisionMakerCornOSR__c,
                                    DEKALB_Club_Member__c,
                                    FR_Farmer_Qualification__c,
                                    //OtherAddress,
                                    FR_Total_DEKALB_Corn_Potential_CY__c,
                                    FR_Total_DEKALB_Corn_Potential_PY__c,
                                    FR_Total_DEKALB_OSR_Potential_PY__c,
                                    FRML_ACCOUNT_COUNTY__c,
                                    VISITED_CHK__c                                    
                            from Contacts ) 
                        FROM Account
                        WHERE (NOT( lastModifiedDate <= :accRequest.pagetimestamp AND Id NOT in :accountsWithContactsModified ))
                               AND( RecordTypeId!=:OtherRecordType AND RecordTypeId!=null)
                                AND ID  in :accShared            
                                AND ID> : accRequest.lastId
                                // AND ID IN ('001M000000YsUsK','001D000000vJ0wY')
                                ORDER BY ID 
                                LIMIT : (queryLimit - rows)            
                        ])
            {
          acc.shared__c=true;             
                returned.Accounts.add(acc);
            }
            
      rows=returned.Accounts.size();
      if(rows==queryLimit)
      {
        accRequest.lastId=returned.Accounts.get(rows-1).Id;
      }                  
      }
                
                
        returned.pagetimestamp=accRequest.pagetimestamp;
        returned.mode=accRequest.mode;       
        returned.lastItem=accRequest.lastItem; 
               
        returned.calculateTimestamp(accRequest.maxtimestamp);
                       
        return returned;        

    }      
            
    global class REST_LogicalEntity_Account{
        public List<Account> Accounts {get;set;}
        public DateTime timestamp {get;set;}
        public DateTime pagetimestamp {get;set;}               
        public DateTime maxtimestamp {get;set;}
        public Boolean queryMore {get;set;}
        public Integer mode {get;set;} //1 owner, 2 shared, 3 others
        public Integer lastItem {get;set;}      
        public String lastId {get;set;}
                          
        public void calculateTimestamp(Datetime reqMaxTimestamp){
            
            maxtimestamp=reqMaxTimestamp;
                         
            for(Account acc : Accounts){
                if(maxtimestamp == null || maxtimestamp < acc.LastModifiedDate) maxtimestamp = acc.LastModifiedDate;   
                for(Contact con : acc.Contacts__r)
                {
                    if(maxtimestamp == null || maxtimestamp < con.LastModifiedDate) maxtimestamp = con.LastModifiedDate;               
                }                   
            } 
            
            if(accounts.size()<queryLimit)
            {
                timestamp=maxtimestamp;
                queryMore=false;
                pagetimestamp=maxtimestamp;
                mode=0;
                lastItem=0;
                LastId='';              
            }
            else
            {
                queryMore=true;
                lastId=(String)Accounts.get(queryLimit-1).ID;          
            }
           timestamp=pagetimestamp;            
        }       
    }
    
}